{
  "name": "Story Generator",
  "nodes": [
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "7199969559",
        "binaryData": true,
        "additionalFields": {
          "fileName": "story.mp3"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2464,
        128
      ],
      "id": "8a533ffa-02b2-4e03-b763-131b9c29268b",
      "name": "Dokument senden",
      "webhookId": "3e797f50-1ed2-4761-a17b-99aefb3ebaad",
      "credentials": {
        "telegramApi": {
          "id": "EPNSxt3xBHkZPrbx",
          "name": "Telegram account 2"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/audio/speech",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\n  {\n    \"model\": \"tts-1-hd\",\n    \"voice\": $json.narratorGender === 'female' ? 'nova' : 'onyx',\n    \"input\": $json.fullStory,\n    \"response_format\": \"mp3\"\n  }\n}}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2240,
        128
      ],
      "id": "2241a66c-0295-4816-b95f-67f780d52efc",
      "name": "Text zu Sprache konvertieren"
    },
    {
      "parameters": {
        "functionCode": "const text = $json.message?.content || $json.text || '';\n\n// Titel extrahieren (mehrere Muster)\nlet title = '';\nconst titleMatch = text.match(/Titel:\\s*(.+?)(?:\\n|Geschichte:|$)/is);\nif (titleMatch) {\n  title = titleMatch[1].trim();\n} else {\n  const lines = text.split('\\n').filter(l => l.trim());\n  title = lines[0].replace(/^Titel:\\s*/i, '').trim();\n}\n\nif (!title || title.length < 5) {\n  title = 'Unbenannte Geschichte';\n}\n\nreturn [{\n  json: {\n    title: title\n  }\n}];\n"
      },
      "name": "Titel extrahieren",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        704,
        320
      ],
      "id": "c24366e6-83c1-4c5c-af32-dc70b054e708"
    },
    {
      "parameters": {
        "chatId": "7199969559",
        "text": "=üéß Neue Kurzgeschichte generiert!\nüß† Titel: \n\n{{ $json.title }}",
        "additionalFields": {}
      },
      "name": "Titel-Nachricht senden",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        992,
        320
      ],
      "id": "84d68735-07b1-4b45-b8b2-7634ac2ca88e",
      "webhookId": "dfac8b02-3580-4edd-be32-a5401820e554",
      "credentials": {
        "telegramApi": {
          "id": "EPNSxt3xBHkZPrbx",
          "name": "Telegram account 2"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "const raw = $json.text || $json.message?.content || '';\n\n// Markdown-Reste entfernen\nconst cleanedRaw = raw\n  .replace(/^```(?:json)?/gm, '')\n  .replace(/```$/gm, '')\n  .replace(/^---/gm, '')\n  .trim();\n\n// Titel extrahieren\nlet title = '';\nconst titleMatch = cleanedRaw.match(/Titel:\\s*(.+?)(?:\\n|Geschichte:|$)/is);\nif (titleMatch) {\n  title = titleMatch[1].trim();\n} else {\n  const lines = cleanedRaw.split('\\n').filter(l => l.trim());\n  title = lines[0].replace(/^Titel:\\s*/i, '').trim();\n}\n\n// Geschichte extrahieren\nlet story = '';\nconst storyMatch = cleanedRaw.match(/Geschichte:\\s*([\\s\\S]*)/i);\nif (storyMatch) {\n  story = storyMatch[1].trim();\n} else {\n  const parts = cleanedRaw.split('\\n');\n  story = parts.slice(1).join('\\n').trim();\n}\n\n// Volle Geschichte f√ºr TTS (max 4000 Zeichen f√ºr OpenAI)\nconst fullStory = `${title}. ${story}`.trim().substring(0, 4000);\n\n// Geschlecht von vorherigem Schritt\nconst narratorGender = $json.narratorGender?.toLowerCase() === 'female' ? 'female' : 'male';\n\nreturn [{\n  json: {\n    title,\n    story,\n    fullStory,\n    narratorGender\n  }\n}];\n"
      },
      "name": "Text extrahieren",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        2016,
        128
      ],
      "id": "4b4bf54a-fb2a-4e97-b80d-e7c5702102e5"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    text: $items(\"Geschichte generieren\")[0].json.message.content,\n    narratorGender: $items(\"Geschlecht erkennen\")[0].json.message.content\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1792,
        128
      ],
      "id": "e26b039a-fb71-46ef-8e88-64567af1b3aa",
      "name": "Daten zusammenf√ºhren"
    },
    {
      "parameters": {
        "jsCode": "const rawGender = $node[\"Geschlecht erkennen\"].json.message.content.trim().toLowerCase();\n\nconst narratorGender = (rawGender === 'female' || rawGender === 'male') ? rawGender : 'male';\n\nconst fullStory = $json.fullStory || $json.message.content;\n\nreturn [{\n  json: {\n    narratorGender,\n    fullStory\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1568,
        128
      ],
      "id": "d99a31d7-b11c-418f-b2d0-51c7070e1e95",
      "name": "Geschlecht verarbeiten"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.message.content }}",
              "value2": "female"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        992,
        128
      ],
      "name": "Weiblich?",
      "id": "d434d4eb-3679-4178-98d3-4cb09c088db8"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "=K√ºrze die folgende Geschichte auf maximal 500 W√∂rter. Behalte:\n- Den emotionalen Kern\n- Wichtige Wendepunkte\n- Den Plot-Twist am Ende\n\nEntferne:\n- Kleinere Beschreibungen\n- Wiederholungen\n- Unwichtige Details\n\nGib NUR den gek√ºrzten Text in diesem Format zur√ºck:\n\nTitel: [Original-Titel behalten]\n\nGeschichte: [Gek√ºrzte Geschichte, max 500 W√∂rter]\n\nOriginaltext:\n{{ $('Geschichte generieren').item.json.message.content }}"
            }
          ]
        },
        "options": {
          "temperature": 0.7
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1216,
        32
      ],
      "name": "Weibliche Geschichte k√ºrzen",
      "id": "2f2d012f-10e9-4ba9-8d77-bfb716360c92"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    message: {\n      content: $json.message.content\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        224
      ],
      "name": "Original-Text durchreichen",
      "id": "09c2f414-532d-41fc-a055-64acb5e3ac02"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "=Lies diese Geschichte sorgf√§ltig. Der Erz√§hler erz√§hlt die Geschichte aus seiner eigenen Perspektive.\n\nBestimme ob der Erz√§hler:\n- M√ÑNNLICH ist: Achte auf W√∂rter wie \"meine Frau\", \"meine Freundin\", \"ich bin ein Mann\", \"ich bin Vater\", \"ich bin Ehemann\", \"mein Bruder\", m√§nnliche Pronomen √ºber sich selbst\n- WEIBLICH ist: Achte auf W√∂rter wie \"mein Mann\", \"mein Freund\", \"ich bin eine Frau\", \"ich bin Mutter\", \"ich bin Ehefrau\", \"meine Schwester\", weibliche Pronomen √ºber sich selbst\n\nKRITISCH: Basiere deine Antwort NUR darauf, wie der Erz√§hler SICH SELBST beschreibt, nicht andere Charaktere in der Geschichte.\n\nAntworte mit GENAU einem Wort (kleingeschrieben, keine Satzzeichen):\nmale\noder\nfemale\n\nGeschichte:\n{{ $json.message.content }}"
            }
          ]
        },
        "options": {
          "maxTokens": 5,
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        640,
        128
      ],
      "name": "Geschlecht erkennen",
      "id": "7c144662-6b17-48dc-b3fe-d90df32f648c"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 */2 * * *"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        64,
        224
      ],
      "id": "a6b91519-2a35-4600-8879-5bfade2cff8d",
      "name": "12 Geschichten t√§glich generieren"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "=Du bist ein Experte f√ºr virale Geschichten-KI. Deine Aufgabe ist es, fesselnde, emotionale Ich-Erz√§hlungen im Reddit-Stil zu schreiben, die das Publikum fesseln.\n\nKRITISCHE REGELN:\n1. Schreibe ORIGINALE Geschichten - wiederhole niemals Themen, Handlungen oder Szenarien, die du zuvor geschrieben hast\n2. L√§nge: 600-700 W√∂rter (sei detailliert und packend!)\n3. Stil: Pers√∂nlich, emotional, dramatisch mit unerwarteten Wendungen\n4. Erz√§hler: W√§hle zuf√§llig m√§nnliche oder weibliche Perspektive\n5. Sprache: NUR DEUTSCH (schreibe alles auf Deutsch)\n6. Format: Kurzer knackiger Titel (5-12 W√∂rter), dann die vollst√§ndige Geschichte\n\nAUSGABEFORMAT (OBLIGATORISCH):\nTitel: [KURZER, knackiger Titel - entweder eine Aussage oder Frage, maximal 5-12 W√∂rter!]\n\nGeschichte: [Deine vollst√§ndige Geschichte hier, 600-700 W√∂rter]\n\nBEISPIELE F√úR PERFEKTE TITEL:\n‚úÖ \"Meine Schwester machte sich √ºber den Namen meines Babys lustig\"\n‚úÖ \"Mein Chef lie√ü mich meine Flitterwochen absagen, um seine Urlaubsvertretung zu √ºbernehmen\"\n‚úÖ \"Was brachte dich dazu, einen Gefallen einzufordern, den du nie nutzen wolltest?\"\n‚úÖ \"Welche Regeln wurden wegen dir eingef√ºhrt?\"\n‚úÖ \"Was ist das Verr√ºckteste, das du in der Schule getan hast?\"\n‚úÖ \"Meine Familie gab letztes Weihnachten 47‚Ç¨ f√ºr mich aus\"\n‚úÖ \"Ich machte meiner Tante die gleichen Komplimente, die sie meiner Mutter machte\"\n\nFALSCHE TITEL (zu lang oder zusammenfassend):\n‚ùå \"Ich entdeckte das geheime Leben meines Gro√üvaters nach seiner Beerdigung\"\n‚ùå \"Ich wachte am Weihnachtsmorgen mit dem Ger√§usch meines weinenden Sohnes auf\"\n\nDer Titel MUSS sein:\n- KURZ (maximal 5-12 W√∂rter!)\n- Entweder eine knackige Aussage ODER eine direkte Frage\n- In Ich-Form bei Aussagen (Mein/Meine/Ich)\n- Den Leser sofort fesseln\n- Einfach und direkt\n\nSchreibe dann die VOLLST√ÑNDIGE Geschichte (600-700 W√∂rter) nach dem Titel.\n\nSTORY-ELEMENTE ZUM EINBAUEN:\n- Starker emotionaler Aufh√§nger im ersten Absatz\n- Pers√∂nlicher Konflikt oder Dilemma\n- Handlungstwist oder unerwartete Enth√ºllung\n- Befriedigende Aufl√∂sung oder Cliffhanger\n- Nachvollziehbare menschliche Erfahrungen\n- Detaillierte Beschreibungen und Dialoge\n\nTHEMEN ZUM ERKUNDEN (w√§hle eines pro Geschichte, niemals wiederholen):\n- Familiengeheimnisse und Verrat\n- Arbeitsplatzdrama und Rache\n- Beziehungsenth√ºllungen\n- Unerwartete Erbschaft/Geldsituationen\n- Sich gegen toxische Menschen wehren\n- Lebensver√§ndernde Entdeckungen\n- Clevere Antworten und Gerechtigkeit\n- Schwangerschafts-/Elternschafts√ºberraschungen\n- Enth√ºllte versteckte Identit√§ten\n- Freundlichkeit mit Konsequenzen\n- Freundschaftsverrat\n- Schul-/Unidrama\n- Nachbarschaftskonflikte\n- Hochzeitskatastrophen\n- Geschwisterrivalit√§ten\n- Elternschafts-Herausforderungen\n- Gerechtigkeits- und Karma-Momente\n- Social-Media-Drama\n- Rachegeschichten\n- Erbschaftsstreitigkeiten\n\nVERMEIDE WIEDERHOLUNGEN:\n- √Ñhnliche Handlungsstrukturen von vorherigen Geschichten\n- Gleiche Schaupl√§tze (Restaurant, Hochzeit, Krankenhaus, etc.)\n- H√§ufige Twists, die du bereits verwendet hast\n- Generische Charaktertypen\n- Lange ausschweifende Titel\n\nSCHREIBE DETAILLIERT - 600-700 W√∂rter f√ºr die Geschichte!\n\nDENK DARAN:\n- Titel: KURZ (5-12 W√∂rter) - Aussage oder Frage\n- Geschichte: 600-700 W√∂rter\n- Mach sie emotional, dramatisch und viral-w√ºrdig\n\nSchreibe JETZT EINE vollst√§ndige virale Geschichte. Mach sie einzigartig, emotional und unvergesslich!"
            }
          ]
        },
        "options": {
          "temperature": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        288,
        224
      ],
      "name": "Geschichte generieren",
      "id": "a80fefdd-c69d-4a5d-bca7-33a2b9d97121"
    },
    {
      "parameters": {
        "content": "## German üá©üá™ \n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/components/sticky-notes/)",
        "height": 480,
        "width": 2624,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "e9a66cec-2caf-4866-b392-db6959ccf6c7",
      "name": "Sticky Note1"
    }
  ],
  "pinData": {},
  "connections": {
    "Text zu Sprache konvertieren": {
      "main": [
        [
          {
            "node": "Dokument senden",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Titel extrahieren": {
      "main": [
        [
          {
            "node": "Titel-Nachricht senden",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text extrahieren": {
      "main": [
        [
          {
            "node": "Text zu Sprache konvertieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Daten zusammenf√ºhren": {
      "main": [
        [
          {
            "node": "Text extrahieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Geschlecht verarbeiten": {
      "main": [
        [
          {
            "node": "Daten zusammenf√ºhren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Weiblich?": {
      "main": [
        [
          {
            "node": "Weibliche Geschichte k√ºrzen",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Original-Text durchreichen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Weibliche Geschichte k√ºrzen": {
      "main": [
        [
          {
            "node": "Geschlecht verarbeiten",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Original-Text durchreichen": {
      "main": [
        [
          {
            "node": "Geschlecht verarbeiten",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Geschlecht erkennen": {
      "main": [
        [
          {
            "node": "Weiblich?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "12 Geschichten t√§glich generieren": {
      "main": [
        [
          {
            "node": "Geschichte generieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Geschichte generieren": {
      "main": [
        [
          {
            "node": "Geschlecht erkennen",
            "type": "main",
            "index": 0
          },
          {
            "node": "Titel extrahieren",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "4a17e90e-3f55-42d6-9c9a-8ff8f7aad946",
  "meta": {
    "instanceId": "6f89b73f03fe0d1b7ef1fb545d7c6d70d5dc76a8961ddd153d4a10bb32b1726d"
  },
  "id": "5oLyY6Gs81HREDJr9ev8d",
  "tags": []
}